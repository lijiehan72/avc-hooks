{"version":3,"file":"index.js","sources":["../src/utils/cloneDeep.js","../src/request/cacheXHR.js","../src/index.tsx"],"sourcesContent":["export default function cloneDeep(obj) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n        return obj;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n        const copy = [];\r\n        for (let i = 0; i < obj.length; i++) {\r\n            copy[i] = cloneDeep(obj[i]);\r\n        }\r\n        return copy;\r\n    }\r\n\r\n    const copy = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            copy[key] = cloneDeep(obj[key]);\r\n        }\r\n    }\r\n    return copy;\r\n}\r\n","import cloneDeep from '../utils/cloneDeep'\n\nfunction XHR(axios,cacheConfig={}) {\n    cacheConfig = {\n        cacheStore: 'avc-cache',\n        updateKey:'updateKey',\n        ...cacheConfig\n    }\n    let cache = null;\n    const responseBk = cloneDeep(axios.interceptors.response.handlers)\n    const requestBk = cloneDeep(axios.interceptors.request.handlers)\n    axios.interceptors.response.clear()\n    axios.interceptors.request.clear()\n    axios.interceptors.request.use(async (config)=> {\n        if (config.method.toLowerCase() !== 'get'){\n            return config;\n        }\n        let cacheKey = config.url;\n        let update = false;\n        if (config.method.toLowerCase() === 'get' && config.params) {\n            if (config.params[cacheConfig.updateKey]){\n                update = config.params?.[cacheConfig.updateKey];\n                delete config.params[cacheConfig.updateKey];\n            }\n            cacheKey += '?' + new URLSearchParams(config.params).toString();\n        }\n\n        if (cache === null){\n            cache = await caches.open(cacheConfig.cacheStore)\n        }\n        const response = await cache.match(cacheKey);\n        if (response && !update) {\n            const rr = await response.json();\n            return Promise.reject({\n                cacheData:rr\n            })\n        }\n        if (requestBk&&requestBk[0]&&requestBk[0].fulfilled){\n            return requestBk[0].fulfilled(config)\n        }\n        return config;\n    }, (error) => {\n        if (requestBk&&requestBk[0]&&requestBk[0].rejected){\n            return requestBk[0].rejected(error)\n        }\n        return Promise.reject(error);\n    });\n\n    axios.interceptors.response.use(function (response) {\n        if (response.config.method.toLowerCase() !== 'get'){\n            return response;\n        }\n        // 请求成功时，根据修改后的规则保存响应结果到缓存\n        let cacheKey = response.config.url;\n        if (response.config.method.toLowerCase() === 'get' && response.config.params) {\n            cacheKey += '?' + new URLSearchParams(response.config.params).toString();\n        }\n        cache.put(cacheKey,  new Response(JSON.stringify(response)))\n        if (responseBk&&responseBk[0]&&responseBk[0].fulfilled){\n            return responseBk[0].fulfilled(response)\n        }\n        return response;\n    }, function (error) {\n        if (error.cacheData){\n            return Promise.resolve(error.cacheData)\n        }\n        if (responseBk&&responseBk[0]&&responseBk[0].rejected){\n            return responseBk[0].rejected(error)\n        }\n        // 处理错误\n        return Promise.reject(error);\n    });\n\n    return axios;\n}\n\nexport default XHR;\n","import React from 'react'\nimport cacheXHR from './request/cacheXHR'\nimport styles from './styles.module.css'\n\ninterface Props {\n  text: string\n}\n\nexport const ExampleComponent = ({ text }: Props) => {\n  return <div className={styles.test}>Example Component: {text}</div>\n}\nexport const cacheRequest = cacheXHR\n"],"names":["cloneDeep","obj","Array","isArray","copy","i","length","key","Object","prototype","hasOwnProperty","call","XHR","axios","cacheConfig","_extends","cacheStore","updateKey","cache","responseBk","interceptors","response","handlers","requestBk","request","clear","use","config","_temp4","Promise","resolve","match","cacheKey","then","_exit","_temp2","_result","fulfilled","_temp","update","json","rr","_Promise$reject","reject","cacheData","method","toLowerCase","url","params","_config$params","URLSearchParams","toString","_temp3","caches","open","_caches$open","e","error","rejected","put","Response","JSON","stringify","ExampleComponent","_ref","text","React","className","styles","test","cacheRequest","cacheXHR"],"mappings":"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"}