{"version":3,"file":"index.js","sources":["../src/request/cloneDeep.js","../src/request/cacheRequest.js","../src/index.tsx"],"sourcesContent":["export default function cloneDeep(obj) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n        return obj;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n        const copy = [];\r\n        for (let i = 0; i < obj.length; i++) {\r\n            copy[i] = cloneDeep(obj[i]);\r\n        }\r\n        return copy;\r\n    }\r\n\r\n    const copy = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            copy[key] = cloneDeep(obj[key]);\r\n        }\r\n    }\r\n    return copy;\r\n}\r\n","import cloneDeep from './cloneDeep'\n\n\nfunction XHR(axios,cacheConfig={\n    cacheStore: 'avc',\n}) {\n    let cache = null;\n    const bk = cloneDeep(axios.interceptors.response.handlers)\n    axios.interceptors.response.clear()\n    axios.interceptors.request.use(async (config)=> {\n\n        // 准备缓存的key，如果是GET请求，考虑将参数加入URL\n        let cacheKey = config.url;\n        if (config.method.toLowerCase() === 'get' && config.params) {\n            // 将参数序列化为字符串并附加到URL上\n            cacheKey += '?' + new URLSearchParams(config.params).toString();\n        }\n        if (cache === null){\n            cache = await caches.open(cacheConfig.cacheStore)\n        }\n        const response = await cache.match(cacheKey);\n        if (response) {\n            const rr = await response.json();\n            return Promise.reject({\n                cacheData:rr\n            })\n        }\n        return config;\n    });\n\n    axios.interceptors.response.use(function (response) {\n        // 请求成功时，根据修改后的规则保存响应结果到缓存\n        let cacheKey = response.config.url;\n        if (response.config.method.toLowerCase() === 'get' && response.config.params) {\n            cacheKey += '?' + new URLSearchParams(response.config.params).toString();\n        }\n        cache.put(cacheKey,  new Response(JSON.stringify(response)))\n        return response;\n    }, function (error) {\n        if (error.cacheData){\n            return Promise.resolve(error.cacheData)\n        }\n        // 处理错误\n        return Promise.reject(error);\n    });\n    axios.interceptors.response.use(async (response) => {\n        if (bk&&bk[0]&&bk[0].fulfilled){\n            return bk[0].fulfilled(response)\n        }\n        return response;\n    }, (error) => {\n        if (bk&&bk[0]&&bk[0].rejected){\n            return bk[0].rejected(error)\n        }\n        return Promise.reject(error);\n    })\n\n    return axios;\n}\n\nexport default XHR;\n","import * as React from 'react'\nimport CacheHttpRequest from './request/cacheRequest'\nimport styles from './styles.module.css'\n\ninterface Props {\n  text: string\n}\n\nexport const ExampleComponent = ({ text }: Props) => {\n  return <div className={styles.test}>Example Component: {text}</div>\n}\nexport const CacheRequest = CacheHttpRequest\n"],"names":["cloneDeep","obj","Array","isArray","copy","i","length","key","Object","prototype","hasOwnProperty","call","XHR","axios","cacheConfig","cacheStore","cache","bk","interceptors","response","handlers","clear","request","use","config","_temp3","Promise","resolve","match","cacheKey","then","_exit","_temp","json","rr","_Promise$reject","reject","cacheData","_result","url","method","toLowerCase","params","URLSearchParams","toString","_temp2","caches","open","_caches$open","e","put","Response","JSON","stringify","error","fulfilled","rejected","ExampleComponent","_ref","text","React","className","styles","test","CacheRequest","CacheHttpRequest"],"mappings":";;AAAe,SAASA,SAASA,CAACC,GAAG,EAAE;EACnC,IAAIA,GAAG,KAAK,IAAI,IAAI,OAAOA,GAAG,KAAK,QAAQ,EAAE;IACzC,OAAOA,GAAG;;EAGd,IAAIC,KAAK,CAACC,OAAO,CAACF,GAAG,CAAC,EAAE;IACpB,IAAMG,KAAI,GAAG,EAAE;IACf,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,GAAG,CAACK,MAAM,EAAED,CAAC,EAAE,EAAE;MACjCD,KAAI,CAACC,CAAC,CAAC,GAAGL,SAAS,CAACC,GAAG,CAACI,CAAC,CAAC,CAAC;;IAE/B,OAAOD,KAAI;;EAGf,IAAMA,IAAI,GAAG,EAAE;EACf,KAAK,IAAMG,GAAG,IAAIN,GAAG,EAAE;IACnB,IAAIO,MAAM,CAACC,SAAS,CAACC,cAAc,CAACC,IAAI,CAACV,GAAG,EAAEM,GAAG,CAAC,EAAE;MAChDH,IAAI,CAACG,GAAG,CAAC,GAAGP,SAAS,CAACC,GAAG,CAACM,GAAG,CAAC,CAAC;;;EAGvC,OAAOH,IAAI;AACf;;ACjBA,SAASQ,GAAGA,CAACC,KAAK,EAACC,WAAW,EAE3B;EAAA,IAFgBA,WAAW;IAAXA,WAAW,GAAC;MAC3BC,UAAU,EAAE;KACf;;EACG,IAAIC,KAAK,GAAG,IAAI;EAChB,IAAMC,EAAE,GAAGjB,SAAS,CAACa,KAAK,CAACK,YAAY,CAACC,QAAQ,CAACC,QAAQ,CAAC;EAC1DP,KAAK,CAACK,YAAY,CAACC,QAAQ,CAACE,KAAK,EAAE;EACnCR,KAAK,CAACK,YAAY,CAACI,OAAO,CAACC,GAAG,WAAQC,MAAM;IAAA,IAAI;MAAA,IAAAC,MAAA,YAAAA;QAAA,OAAAC,OAAA,CAAAC,OAAA,CAWrBX,KAAK,CAACY,KAAK,CAACC,QAAQ,CAAC,EAAAC,IAAA,WAAtCX,QAAQ;UAAA,IAAAY,KAAA;UAAA,IAAAC,KAAA;YAAA,IACVb,QAAQ;cAAA,OAAAO,OAAA,CAAAC,OAAA,CACSR,QAAQ,CAACc,IAAI,EAAE,EAAAH,IAAA,WAA1BI,EAAE;gBAAA,IAAAC,eAAA,GACDT,OAAO,CAACU,MAAM,CAAC;kBAClBC,SAAS,EAACH;iBACb,CAAC;gBAAAH,KAAA;gBAAA,OAAAI,eAAA;;;;UAAA,OAAAH,KAAA,IAAAA,KAAA,CAAAF,IAAA,GAAAE,KAAA,CAAAF,IAAA,WAAAQ,OAAA;YAAA,OAAAP,KAAA,GAAAO,OAAA,GAECd,MAAM;eAAAO,KAAA,GAAAC,KAAA,GAANR,MAAM;;;MAfb,IAAIK,QAAQ,GAAGL,MAAM,CAACe,GAAG;MACzB,IAAIf,MAAM,CAACgB,MAAM,CAACC,WAAW,EAAE,KAAK,KAAK,IAAIjB,MAAM,CAACkB,MAAM,EAAE;QAExDb,QAAQ,IAAI,GAAG,GAAG,IAAIc,eAAe,CAACnB,MAAM,CAACkB,MAAM,CAAC,CAACE,QAAQ,EAAE;;MAClE,IAAAC,MAAA;QAAA,IACG7B,KAAK,KAAK,IAAI;UAAA,OAAAU,OAAA,CAAAC,OAAA,CACAmB,MAAM,CAACC,IAAI,CAACjC,WAAW,CAACC,UAAU,CAAC,EAAAe,IAAA,WAAAkB,YAAA;YAAjDhC,KAAK,GAAAgC,YAA4C;;;;MAAA,OAAAtB,OAAA,CAAAC,OAAA,CAAAkB,MAAA,IAAAA,MAAA,CAAAf,IAAA,GAAAe,MAAA,CAAAf,IAAA,CAAAL,MAAA,IAAAA,MAAA,CAAAoB,MAAA;KAUxD,QAAAI,CAAA;MAAA,OAAAvB,OAAA,CAAAU,MAAA,CAAAa,CAAA;;IAAC;EAEFpC,KAAK,CAACK,YAAY,CAACC,QAAQ,CAACI,GAAG,CAAC,UAAUJ,QAAQ,EAAE;IAEhD,IAAIU,QAAQ,GAAGV,QAAQ,CAACK,MAAM,CAACe,GAAG;IAClC,IAAIpB,QAAQ,CAACK,MAAM,CAACgB,MAAM,CAACC,WAAW,EAAE,KAAK,KAAK,IAAItB,QAAQ,CAACK,MAAM,CAACkB,MAAM,EAAE;MAC1Eb,QAAQ,IAAI,GAAG,GAAG,IAAIc,eAAe,CAACxB,QAAQ,CAACK,MAAM,CAACkB,MAAM,CAAC,CAACE,QAAQ,EAAE;;IAE5E5B,KAAK,CAACkC,GAAG,CAACrB,QAAQ,EAAG,IAAIsB,QAAQ,CAACC,IAAI,CAACC,SAAS,CAAClC,QAAQ,CAAC,CAAC,CAAC;IAC5D,OAAOA,QAAQ;GAClB,EAAE,UAAUmC,KAAK,EAAE;IAChB,IAAIA,KAAK,CAACjB,SAAS,EAAC;MAChB,OAAOX,OAAO,CAACC,OAAO,CAAC2B,KAAK,CAACjB,SAAS,CAAC;;IAG3C,OAAOX,OAAO,CAACU,MAAM,CAACkB,KAAK,CAAC;GAC/B,CAAC;EACFzC,KAAK,CAACK,YAAY,CAACC,QAAQ,CAACI,GAAG,WAAQJ,QAAQ;IAAA,IAAK;MAChD,IAAIF,EAAE,IAAEA,EAAE,CAAC,CAAC,CAAC,IAAEA,EAAE,CAAC,CAAC,CAAC,CAACsC,SAAS,EAAC;QAC3B,OAAA7B,OAAA,CAAAC,OAAA,CAAOV,EAAE,CAAC,CAAC,CAAC,CAACsC,SAAS,CAACpC,QAAQ,CAAC;;MAEpC,OAAAO,OAAA,CAAAC,OAAA,CAAOR,QAAQ;KAClB,QAAA8B,CAAA;MAAA,OAAAvB,OAAA,CAAAU,MAAA,CAAAa,CAAA;;KAAE,UAACK,KAAK,EAAK;IACV,IAAIrC,EAAE,IAAEA,EAAE,CAAC,CAAC,CAAC,IAAEA,EAAE,CAAC,CAAC,CAAC,CAACuC,QAAQ,EAAC;MAC1B,OAAOvC,EAAE,CAAC,CAAC,CAAC,CAACuC,QAAQ,CAACF,KAAK,CAAC;;IAEhC,OAAO5B,OAAO,CAACU,MAAM,CAACkB,KAAK,CAAC;GAC/B,CAAC;EAEF,OAAOzC,KAAK;AAChB;;;;IClDa4C,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAAC,IAAA;MAAMC,IAAI,GAAAD,IAAA,CAAJC,IAAI;EACrC,OAAOC;IAAKC,SAAS,EAAEC,MAAM,CAACC;4BAA0BJ,IAAI,CAAO;AACrE,CAAC;AACD,IAAaK,YAAY,GAAGC;;;;;"}