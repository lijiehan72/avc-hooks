{"version":3,"file":"index.modern.js","sources":["../src/utils/cloneDeep.js","../src/request/cacheXHR.js","../src/index.tsx"],"sourcesContent":["export default function cloneDeep(obj) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n        return obj;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n        const copy = [];\r\n        for (let i = 0; i < obj.length; i++) {\r\n            copy[i] = cloneDeep(obj[i]);\r\n        }\r\n        return copy;\r\n    }\r\n\r\n    const copy = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            copy[key] = cloneDeep(obj[key]);\r\n        }\r\n    }\r\n    return copy;\r\n}\r\n","import cloneDeep from '../utils/cloneDeep'\n\nfunction XHR(axios,cacheConfig={}) {\n    cacheConfig = {\n        cacheStore: 'avc-cache',\n        updateKey:'updateKey',\n        ...cacheConfig\n    }\n    let cache = null;\n    const responseBk = cloneDeep(axios.interceptors.response.handlers)\n    const requestBk = cloneDeep(axios.interceptors.request.handlers)\n    axios.interceptors.response.clear()\n    axios.interceptors.request.clear()\n    axios.interceptors.request.use(async (config)=> {\n        if (config.method.toLowerCase() !== 'get'){\n            return config;\n        }\n        let cacheKey = config.url;\n        let update = false;\n        if (config.method.toLowerCase() === 'get' && config.params) {\n            if (config.params[cacheConfig.updateKey]){\n                update = config.params?.[cacheConfig.updateKey];\n                delete config.params[cacheConfig.updateKey];\n            }\n            cacheKey += '?' + new URLSearchParams(config.params).toString();\n        }\n\n        if (cache === null){\n            cache = await caches.open(cacheConfig.cacheStore)\n        }\n        const response = await cache.match(cacheKey);\n        if (response && !update) {\n            const rr = await response.json();\n            return Promise.reject({\n                cacheData:rr\n            })\n        }\n        if (requestBk&&requestBk[0]&&requestBk[0].fulfilled){\n            return requestBk[0].fulfilled(config)\n        }\n        return config;\n    }, (error) => {\n        if (requestBk&&requestBk[0]&&requestBk[0].rejected){\n            return requestBk[0].rejected(error)\n        }\n        return Promise.reject(error);\n    });\n\n    axios.interceptors.response.use(function (response) {\n        if (response.config.method.toLowerCase() !== 'get'){\n            return response;\n        }\n        // 请求成功时，根据修改后的规则保存响应结果到缓存\n        let cacheKey = response.config.url;\n        if (response.config.method.toLowerCase() === 'get' && response.config.params) {\n            cacheKey += '?' + new URLSearchParams(response.config.params).toString();\n        }\n        cache.put(cacheKey,  new Response(JSON.stringify(response)))\n        if (responseBk&&responseBk[0]&&responseBk[0].fulfilled){\n            return responseBk[0].fulfilled(response)\n        }\n        return response;\n    }, function (error) {\n        if (error.cacheData){\n            return Promise.resolve(error.cacheData)\n        }\n        if (responseBk&&responseBk[0]&&responseBk[0].rejected){\n            return responseBk[0].rejected(error)\n        }\n        // 处理错误\n        return Promise.reject(error);\n    });\n\n    return axios;\n}\n\nexport default XHR;\n","import React from 'react'\nimport cacheXHR from './request/cacheXHR'\nimport styles from './styles.module.css'\n\ninterface Props {\n  text: string\n}\n\nexport const ExampleComponent = ({ text }: Props) => {\n  return <div className={styles.test}>Example Component: {text}</div>\n}\nexport const cacheRequest = cacheXHR\n"],"names":["cloneDeep","obj","Array","isArray","copy","i","length","key","Object","prototype","hasOwnProperty","call","XHR","axios","cacheConfig","cacheStore","updateKey","cache","responseBk","interceptors","response","handlers","requestBk","request","clear","use","config","method","toLowerCase","cacheKey","url","update","params","_config$params","URLSearchParams","toString","caches","open","match","rr","json","Promise","reject","cacheData","fulfilled","error","rejected","put","Response","JSON","stringify","resolve","ExampleComponent","text","React","className","styles","test","cacheRequest","cacheXHR"],"mappings":"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"}