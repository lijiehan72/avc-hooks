{"version":3,"file":"index.modern.js","sources":["../src/request/cloneDeep.js","../src/request/cacheRequest.js","../src/index.tsx"],"sourcesContent":["export default function cloneDeep(obj) {\r\n    if (obj === null || typeof obj !== 'object') {\r\n        return obj;\r\n    }\r\n\r\n    if (Array.isArray(obj)) {\r\n        const copy = [];\r\n        for (let i = 0; i < obj.length; i++) {\r\n            copy[i] = cloneDeep(obj[i]);\r\n        }\r\n        return copy;\r\n    }\r\n\r\n    const copy = {};\r\n    for (const key in obj) {\r\n        if (Object.prototype.hasOwnProperty.call(obj, key)) {\r\n            copy[key] = cloneDeep(obj[key]);\r\n        }\r\n    }\r\n    return copy;\r\n}\r\n","import cloneDeep from './cloneDeep'\n\n\nfunction XHR(axios,cacheConfig={\n    cacheStore: 'avc',\n}) {\n    let cache = null;\n    const bk = cloneDeep(axios.interceptors.response.handlers)\n    axios.interceptors.response.clear()\n    axios.interceptors.request.use(async (config)=> {\n\n        // 准备缓存的key，如果是GET请求，考虑将参数加入URL\n        let cacheKey = config.url;\n        if (config.method.toLowerCase() === 'get' && config.params) {\n            // 将参数序列化为字符串并附加到URL上\n            cacheKey += '?' + new URLSearchParams(config.params).toString();\n        }\n        if (cache === null){\n            cache = await caches.open(cacheConfig.cacheStore)\n        }\n        const response = await cache.match(cacheKey);\n        if (response) {\n            const rr = await response.json();\n            return Promise.reject({\n                cacheData:rr\n            })\n        }\n        return config;\n    });\n\n    axios.interceptors.response.use(function (response) {\n        // 请求成功时，根据修改后的规则保存响应结果到缓存\n        let cacheKey = response.config.url;\n        if (response.config.method.toLowerCase() === 'get' && response.config.params) {\n            cacheKey += '?' + new URLSearchParams(response.config.params).toString();\n        }\n        cache.put(cacheKey,  new Response(JSON.stringify(response)))\n        return response;\n    }, function (error) {\n        if (error.cacheData){\n            return Promise.resolve(error.cacheData)\n        }\n        // 处理错误\n        return Promise.reject(error);\n    });\n    axios.interceptors.response.use(async (response) => {\n        if (bk&&bk[0]&&bk[0].fulfilled){\n            return bk[0].fulfilled(response)\n        }\n        return response;\n    }, (error) => {\n        if (bk&&bk[0]&&bk[0].rejected){\n            return bk[0].rejected(error)\n        }\n        return Promise.reject(error);\n    })\n\n    return axios;\n}\n\nexport default XHR;\n","import * as React from 'react'\nimport CacheHttpRequest from './request/cacheRequest'\nimport styles from './styles.module.css'\n\ninterface Props {\n  text: string\n}\n\nexport const ExampleComponent = ({ text }: Props) => {\n  return <div className={styles.test}>Example Component: {text}</div>\n}\nexport const CacheRequest = CacheHttpRequest\n"],"names":["cloneDeep","obj","Array","isArray","copy","i","length","key","Object","prototype","hasOwnProperty","call","XHR","axios","cacheConfig","cacheStore","cache","bk","interceptors","response","handlers","clear","request","use","config","cacheKey","url","method","toLowerCase","params","URLSearchParams","toString","caches","open","match","rr","json","Promise","reject","cacheData","put","Response","JSON","stringify","error","resolve","fulfilled","rejected","ExampleComponent","text","React","className","styles","test","CacheRequest","CacheHttpRequest"],"mappings":"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"}